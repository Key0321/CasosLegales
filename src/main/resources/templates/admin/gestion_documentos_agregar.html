<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mis casos / Nuevo caso</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/admin/admin_menu.css">
  <link rel="stylesheet" href="/css/admin/admin_nuevo_pagina.css">
</head>
<body>
  <div class="menu">
      <div class="menu-logo">
          <img src="../imagenes/logo.png" alt="Logo" />
      </div>

      <div class="menu-item" th:onclick="|window.location.href='@{/admin/inicio}'|">
          <img src="../imagenes/admin_inicio.png" alt="Inicio" />
          <span>Inicio</span>
      </div>

      <div class="menu-item" th:onclick="|window.location.href='@{/admin/gestion_procesos_legales}'|">
          <img src="../imagenes/casos.png" alt="Procesos Legales" />
          <span>Procesos Legales</span>
      </div>

      <div class="menu-item" th:onclick="|window.location.href='@{/admin/gestion_estados}'|">
          <img src="../imagenes/casos.png" alt="Estados de Procesos" />
          <span>Estados de Procesos</span>
      </div>

      <div class="menu-item" th:onclick="|window.location.href='@{/admin/gestion_eventos}'|">
          <img src="../imagenes/casos.png" alt="Audiencias / Eventos" />
          <span>Audiencias / Eventos</span>
      </div>

      <div class="menu-item activo" th:onclick="|window.location.href='@{/admin/gestion_documentos}'|">
          <img src="../imagenes/casos.png" alt="Documentos" />
          <span>Documentos</span>
      </div>

      <div class="menu-item" th:onclick="|window.location.href='@{/admin/gestion_usuarios}'|">
          <img src="../imagenes/admin_usuario.png" alt="Usuarios" />
          <span>Usuarios</span>
      </div>

      <div class="menu-item" th:onclick="|window.location.href='@{/admin/gestion_roles}'|">
          <img src="../imagenes/admin_usuario.png" alt="Roles" />
          <span>Roles</span>
      </div>

      <div class="menu-item" th:onclick="|window.location.href='@{/admin/gestion_clientes}'|">
          <img src="../imagenes/admin_usuario.png" alt="Clientes" />
          <span>Clientes</span>
      </div>

      <div class="menu-item" th:onclick="|window.location.href='@{/admin/gestion_abogados}'|">
          <img src="../imagenes/admin_usuario.png" alt="Abogados" />
          <span>Abogados</span>
      </div>

      <div class="menu-item" th:onclick="|window.location.href='@{/admin/gestion_permisos}'|">
          <img src="../imagenes/admin_usuario.png" alt="Permisos" />
          <span>Permisos</span>
      </div>

      <div class="menu-item" th:onclick="|window.location.href='@{/admin/gestion_notificaciones}'|">
          <img src="../imagenes/admin_comunicacion.png" alt="Notificaciones" />
          <span>Notificaciones</span>
      </div>

      <div class="menu-item" th:onclick="|window.location.href='@{/admin/gestion_observaciones}'|">
          <img src="../imagenes/admin_comunicacion.png" alt="Observaciones" />
          <span>Observaciones</span>
      </div>

      <div class="menu-item" th:onclick="|window.location.href='@{/admin/gestion_chats}'|">
          <img src="../imagenes/admin_comunicacion.png" alt="Chats" />
          <span>Chats</span>
      </div>

      <div class="menu-item" th:onclick="|window.location.href='@{/admin/gestion_ajustes}'|">
          <img src="../imagenes/ajustes.png" alt="Ajustes" />
          <span>Ajustes</span>
      </div>
  </div>

    
<!-- Contenido principal -->
<div class="div-contenido">
    <div class="div-titulo-seccion">
        <a th:href="@{/admin/gestion_documentos}" class="dt-a-link">Documentos</a>
        <span class="dt-sp-separador">/</span>
        <span class="dt-sp-actual">Nuevo</span>
    </div>

    <!-- Mensajes de alerta -->
    <div th:if="${error}" class="alert alert-error" style="color: #721c24; background-color: #f8d7da; padding: 12px; border-radius: 8px; border: 1px solid #f5c6cb; margin-bottom: 20px;">
        <strong>Error:</strong> <span th:text="${error}"></span>
    </div>

    <div th:if="${exito}" class="alert alert-success" style="color: #155724; background-color: #d4edda; padding: 12px; border-radius: 8px; border: 1px solid #c3e6cb; margin-bottom: 20px;">
        ✅ Documento creado exitosamente
    </div>

    <!-- Formulario de creación -->
    <form class="formulario-caso" th:action="@{/admin/guardar_documento}" th:object="${documento}" method="post" enctype="multipart/form-data">

      <div class="form-grupo">
        <label>Proceso legal</label>
        <select th:field="*{proceso.id}" required>
          <option value="">Seleccione un proceso</option>
          <option th:each="proceso : ${procesosMinimos}" 
                  th:value="${proceso[0]}" 
                  th:text="${proceso[1] + ': ' + proceso[2]}">
          </option>
        </select>
      </div>

      <div class="form-grupo">
        <label>Nombre del documento</label>
        <input type="text" th:field="*{nombre}" required maxlength="255" placeholder="Ingrese el nombre del documento" />
      </div>

      <div class="form-grupo">
        <label>Archivo</label>
        <input type="file" id="archivo" name="archivo" required accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png" />
        <small style="color: #666; font-size: 13px; margin-top: 5px;">Formatos permitidos: PDF, Word, Excel, imágenes (Máx. 10MB)</small>
      </div>

      <div class="form-grupo-doble">
        <div class="form-grupo">
          <label>Año</label>
          <input type="number" th:field="*{anio}" min="2000" max="2030" required placeholder="2024" />
        </div>
        
        <div class="form-grupo">
          <label>Mes</label>
          <select th:field="*{mes}" required>
            <option value="">Seleccione un mes</option>
            <option value="1">Enero</option>
            <option value="2">Febrero</option>
            <option value="3">Marzo</option>
            <option value="4">Abril</option>
            <option value="5">Mayo</option>
            <option value="6">Junio</option>
            <option value="7">Julio</option>
            <option value="8">Agosto</option>
            <option value="9">Septiembre</option>
            <option value="10">Octubre</option>
            <option value="11">Noviembre</option>
            <option value="12">Diciembre</option>
          </select>
        </div>
      </div>

      <div class="form-grupo">
        <label>Tipo de documento</label>
        <select th:field="*{tipoDocumento}">
          <option value="">Seleccione un tipo</option>
          <option value="CONTRATO">Contrato</option>
          <option value="DEMANDA">Demanda</option>
          <option value="ESCRITURA">Escritura</option>
          <option value="SENTENCIA">Sentencia</option>
          <option value="OFICIO">Oficio</option>
          <option value="INFORME">Informe</option>
          <option value="OTRO">Otro</option>
        </select>
      </div>

      <div class="form-grupo">
        <label>Palabras clave</label>
        <textarea th:field="*{palabrasClave}" rows="3" placeholder="Ingrese palabras clave separadas por coma (ejemplo: contrato, firma, acuerdo)..."></textarea>
      </div>

      <div class="form-grupo">
        <label>Clave de cifrado (opcional)</label>
        <input type="password" th:field="*{claveCifrado}" maxlength="255" placeholder="Ingrese clave para documentos sensibles" />
        <small style="color: #666; font-size: 13px; margin-top: 5px;">Solo para documentos que requieren protección adicional</small>
      </div>

      <div class="form-grupo">
        <button type="submit" class="dt-btn-agregar">Guardar documento</button>
      </div>

    </form>
</div>

<!-- Script para manejar la selección de archivo -->
<script>
    document.getElementById('archivo').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            // Validar tamaño máximo (10MB)
            const maxSize = 10 * 1024 * 1024;
            if (file.size > maxSize) {
                alert('El archivo excede el tamaño máximo permitido (10MB)');
                e.target.value = '';
                return;
            }
            
            // Si no hay nombre ingresado, usar el nombre del archivo
            const nombreInput = document.querySelector('input[th\\:field*="nombre"]');
            if (!nombreInput.value) {
                nombreInput.value = file.name.split('.')[0];
            }
        }
    });
    
    // Ocultar automáticamente la alerta de éxito después de 5 segundos
    document.addEventListener('DOMContentLoaded', function() {
        const successAlert = document.querySelector('.alert-success');
        if (successAlert) {
            setTimeout(function() {
                successAlert.style.display = 'none';
            }, 5000);
        }
    });
</script>
</body>
</html>